#!<%= ENV["SHELL"] || "/bin/bash" %>
<%= tmux %> start-server\; has-session -t <%= name %> 2>/dev/null

if [ "$?" -eq 1 ]; then
  cd <%= root || "." %>

  # Run pre command.
  <%= pre %>

  # Create the session and the first window.
  <%= tmux %> new-session -d -s <%= name %> -n <%= tabs.first.name %>

  # Set the default path.
  <%= tmux %> set-option -t <%= name %> default-path <%= root -%> 1>/dev/null

  # Create other windows.
  <%- tabs.drop(1).each do |tab| -%>
  <%= tab.tmux_new_window_command %>
  <%- end -%>

  <%- tabs.each do |tab| -%>

  # Window "<%= tab.name %>"
    <%- unless tab.panes? -%>
  <%= tab.tmux_pre_tab_comamnd %>
  <%= tab.tmux_main_command %>
    <%- else -%>
      <%- tab.panes.each do |pane| -%>
  <%= pane.tmux_pre_tab_command %>
  <%= pane.tmux_main_command %>

      <%- unless pane.last? -%>
  <%= pane.tmux_split_command %>
      <%- end -%>
    <%- end -%>


  <%= tab.tmux_layout_command %>
  <%= tab.tmux_select_first_pane %>
    <%- end -%>
  <%- end -%>

  <%= tmux %> select-window -t <%= base_index %>
fi

<%= attach %>
